/*! For license information please see functions.js.LICENSE.txt */
!function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t,n,r){return(n=function(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}var n=function(e){return e.DEBUG="DEBUG",e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR",e}({}),r=n.ERROR,o=t(t(t(t({},n.DEBUG,0),n.INFO,1),n.WARN,2),n.ERROR,3);function a(e,t,a){if(o[e]>=o[r]){var i=(new Date).toISOString(),s="[".concat(i,"] [").concat(e,"] ").concat(t);switch(e){case n.DEBUG:console.debug(s,a||"");break;case n.INFO:console.info(s,a||"");break;case n.WARN:console.warn(s,a||"");break;case n.ERROR:console.error(s,a||"")}}}var i=function(e,t){return a(n.DEBUG,e,t)},s=function(e,t){return a(n.INFO,e,t)},c=function(e,t){return a(n.WARN,e,t)},u=function(e,t){return a(n.ERROR,e,t)};function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function l(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return p(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function y(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return d(u,"_invoke",function(n,r,o){var a,s,c,u=0,f=o||[],l=!1,p={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,n){return a=t,s=0,c=e,p.n=n,i}};function y(n,r){for(s=n,c=r,t=0;!l&&u&&!o&&t<f.length;t++){var o,a=f[t],y=p.p,d=a[2];n>3?(o=d===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=y&&((o=n<2&&y<a[1])?(s=0,p.v=r,p.n=a[1]):y<d&&(o=n<3||a[0]>r||r>d)&&(a[4]=n,a[5]=r,p.n=d,s=0))}if(o||n>1)return i;throw l=!0,r}return function(o,f,d){if(u>1)throw TypeError("Generator is already running");for(l&&1===f&&y(f,d),s=f,c=d;(t=s<2?e:c)||!l;){a||(s?s<3?(s>1&&(p.n=-1),y(s,c)):p.n=c:p.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(l=p.n<0)?c:n.call(r,p))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:l}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(d(t={},r,function(){return this}),t),l=u.prototype=s.prototype=Object.create(f);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,d(e,o,"GeneratorFunction")),e.prototype=Object.create(l),e}return c.prototype=u,d(l,"constructor",u),d(u,"constructor",c),c.displayName="GeneratorFunction",d(u,o,"GeneratorFunction"),d(l),d(l,o,"Generator"),d(l,r,function(){return this}),d(l,"toString",function(){return"[object Generator]"}),(y=function(){return{w:a,m:p}})()}function d(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}d=function(e,t,n,r){function a(t,n){d(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},d(e,t,n,r)}function v(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function h(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){v(a,r,o,i,s,"next",e)}function s(e){v(a,r,o,i,s,"throw",e)}i(void 0)})}}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,b(r.key),r)}}function m(e,t,n){return(t=b(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e){var t=function(e){if("object"!=f(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==f(t)?t:t+""}var S="octagon_api_key",A="CachedSessionSettings",k=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://api-gateway.octagonagents.com/v1";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),m(this,"apiKey",null),m(this,"isOfficeInitialized",!1),this.apiUrl=t,s("OctagonApiService created with API URL: ".concat(this.apiUrl))},t=[{key:"initialize",value:function(){this.isOfficeInitialized=!0,this.loadApiKey(),s("OctagonApiService fully initialized. API key status: ".concat(this.isAuthenticated()?"Available":"Not available"))}},{key:"checkForStoredApiKey",value:function(){try{var e=sessionStorage.getItem(A);if(e){var t=JSON.parse(e);if(t&&t.octagon_api_key)return s("Found API key in CachedSessionSettings"),!0}if(sessionStorage.getItem(S))return s("Found API key in direct SessionStorage"),!0}catch(e){u("Error checking for stored API key",e)}return!1}},{key:"setApiKey",value:function(e){this.apiKey=e,this.saveApiKey(e)}},{key:"saveApiKey",value:function(e){try{sessionStorage.setItem(S,e);try{var t=sessionStorage.getItem(A);if(t){var n=JSON.parse(t);n.octagon_api_key=e,sessionStorage.setItem(A,JSON.stringify(n))}else{var r={octagon_api_key:e};sessionStorage.setItem(A,JSON.stringify(r))}}catch(e){c("Failed to save to CachedSessionSettings",e)}s("API key saved to SessionStorage")}catch(e){u("Failed to save API key to SessionStorage",e)}}},{key:"callAgent",value:(f=h(y().m(function e(t,n){var r,o;return y().w(function(e){for(;;)switch(e.n){case 0:return s("callAgent invoked with agent: ".concat(t,", prompt: ").concat(n.substring(0,50),"...")),i("callAgent request data:",r={model:t,input:n,stream:!0}),e.n=1,this.apiRequest("/responses","POST",r,!0);case 1:if((o=e.v).success){e.n=2;break}return e.a(2,o);case 2:return e.a(2,o)}},e,this)})),function(e,t){return f.apply(this,arguments)})},{key:"loadApiKey",value:function(){s("Attempting to load API key from SessionStorage");try{var e=sessionStorage.getItem(A);if(e)try{var t=JSON.parse(e);if(t&&t.octagon_api_key)return this.apiKey=t.octagon_api_key,void s("API key loaded from CachedSessionSettings")}catch(e){c("Failed to parse CachedSessionSettings",e)}var n=sessionStorage.getItem(S);if(n)return this.apiKey=n,void s("API key loaded from direct SessionStorage")}catch(e){u("Failed to load API key from SessionStorage",e)}s("No API key found in SessionStorage")}},{key:"isAuthenticated",value:function(){return this.apiKey||this.loadApiKey(),!!this.apiKey&&""!==this.apiKey.trim()}},{key:"clearApiKey",value:function(){this.apiKey=null;try{sessionStorage.removeItem(S);var e=sessionStorage.getItem(A);if(e)try{var t=JSON.parse(e);t&&(delete t.octagon_api_key,sessionStorage.setItem(A,JSON.stringify(t)))}catch(e){c("Failed to parse CachedSessionSettings for clearing",e)}s("API key cleared from all SessionStorage locations")}catch(e){u("Failed to clear API key from SessionStorage",e)}}},{key:"apiRequest",value:(a=h(y().m(function e(t){var n,r,o,a,c,f,l,p,d,v=arguments;return y().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=v.length>1&&void 0!==v[1]?v[1]:"POST",r=v.length>2?v[2]:void 0,this.isAuthenticated()){e.n=1;break}return u("API request failed: Not authenticated"),e.a(2,{success:!1,error:"Not authenticated. Please set your API key first."});case 1:return o="".concat(this.apiUrl).concat(t),e.p=2,s("Making ".concat(n," request to ").concat(o),r),a=new Headers({"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)}),i("Request headers:",{contentType:a.get("Content-Type"),authorization:this.apiKey?"Bearer ".concat(this.apiKey.substring(0,5),"..."):"None"}),c=r?JSON.stringify(r):void 0,i("Request body:",c),e.n=3,fetch(o,{method:n,headers:a,body:c});case 3:if(f=e.v,s("Response status: ".concat(f.status," ").concat(f.statusText)),f.ok){e.n=5;break}return e.n=4,f.text();case 4:return l=e.v,u("API request failed: ".concat(f.status," ").concat(f.statusText),l),e.a(2,{success:!1,error:"Request failed (".concat(f.status,"): ").concat(l||f.statusText)});case 5:return e.n=6,this.handleStreamedResponse(f);case 6:return p=e.v,e.a(2,p);case 7:return e.p=7,d=e.v,u("API request failed with exception",d),e.a(2,{success:!1,error:d instanceof Error?d.message:"Unknown error occurred"})}},e,this,[[2,7]])})),function(e){return a.apply(this,arguments)})},{key:"handleStreamedResponse",value:(o=h(y().m(function e(t){var n,r,o,a,f,p,d,v,h,g,m,b,S,A,k,O,E,w,P,R,N,T,I,_,C;return y().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,p=null===(n=t.body)||void 0===n?void 0:n.getReader()){e.n=1;break}return u("Response stream could not be read"),e.a(2,{success:!1,error:"Response stream could not be read"});case 1:s("Processing streamed response"),d="",v=null,h=0;case 2:return e.p=3,e.n=4,p.read();case 4:if(g=e.v,m=g.done,b=g.value,!m){e.n=5;break}return e.a(3,17);case 5:S=(new TextDecoder).decode(b),i("Received stream chunk:",S.substring(0,100)+(S.length>100?"...":"")),A=S.split("\n"),k=l(A),e.p=6,k.s();case 7:if((O=k.n()).done){e.n=11;break}if(!(E=O.value).startsWith("data: ")){e.n=10;break}if("[DONE]"!==(w=E.substring(6)).trim()){e.n=8;break}return s("Stream completed [DONE] marker received"),e.a(3,10);case 8:e.p=8,R=JSON.parse(w),i("Parsed stream data type:",R.type),"response.completed"===R.type?(v=R.response,s("Final response received")):"response.output_text.delta"===R.type||"response.output_text.done"===R.type?R.delta?d+=R.delta:R.text&&(d=R.text):"response.content_part.done"===R.type&&null!==(P=R.part)&&void 0!==P&&P.text?d=R.part.text:R.response&&R.response.output&&(v=R.response),e.n=10;break;case 9:if(e.p=9,T=e.v,h++,c("Error parsing stream JSON (".concat(h,"): ").concat(T," - ").concat(w.substring(0,100))),!(h>5)){e.n=10;break}throw u("Too many JSON parse errors in stream, aborting"),new Error("Stream parsing failed: Too many JSON parse errors");case 10:e.n=7;break;case 11:e.n=13;break;case 12:e.p=12,I=e.v,k.e(I);case 13:return e.p=13,k.f(),e.f(13);case 14:e.n=16;break;case 15:throw e.p=15,_=e.v,u("Error processing stream chunk:",_),_;case 16:e.n=2;break;case 17:return N={content:d||"",id:(null===(r=v)||void 0===r?void 0:r.id)||"",model:(null===(o=v)||void 0===o?void 0:o.model)||"",created:(null===(a=v)||void 0===a?void 0:a.created_at)||Date.now(),output:(null===(f=v)||void 0===f?void 0:f.output)||[],rawResponse:v},s("Streamed response processed successfully"),i("Transformed response:",{contentLength:N.content.length,hasId:!!N.id,hasModel:!!N.model,outputItems:N.output.length}),e.a(2,{success:!0,data:N});case 18:return e.p=18,C=e.v,u("Error processing streamed response:",C),e.a(2,{success:!1,error:C instanceof Error?C.message:"Failed to process streamed response"})}},e,null,[[8,9],[6,12,13,14],[3,15],[0,18]])})),function(e){return o.apply(this,arguments)})},{key:"testConnection",value:(r=h(y().m(function e(){var t,n;return y().w(function(e){for(;;)switch(e.p=e.n){case 0:if(s("Testing API connection with stored key"),this.isAuthenticated()){e.n=1;break}return u("Test connection failed: No API key available"),e.a(2,{success:!1,error:"No API key available for testing"});case 1:return e.p=1,e.n=2,this.apiRequest("/responses","POST",{model:"octagon-agent",input:"Test connection",max_tokens:10},!0);case 2:return t=e.v,s("Test connection result: ".concat(t.success?"Success":"Failed")),t.success&&i("Test connection response format:",{hasContent:t.data&&void 0!==t.data.content,hasChoices:t.data&&Array.isArray(t.data.choices),responseKeys:t.data?Object.keys(t.data):[]}),e.a(2,t);case 3:return e.p=3,n=e.v,u("Test connection threw an exception",n),e.a(2,{success:!1,error:n instanceof Error?n.message:"Unknown error during connection test"})}},e,this,[[1,3]])})),function(){return r.apply(this,arguments)})},{key:"ResponseEndpoint",value:(n=h(y().m(function e(t,n){var r,o=arguments;return y().w(function(e){for(;;)if(0===e.n)return r=!(o.length>2&&void 0!==o[2])||o[2],s("Making stream responses endpoint request",{query:t.substring(0,100)+"...",model:n,stream:r}),e.a(2,this.apiRequest("/responses","POST",{model:n,input:t,stream:r},r))},e,this)})),function(e,t){return n.apply(this,arguments)})}],t&&g(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,o,a,f}();function O(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return E(u,"_invoke",function(n,r,o){var a,s,c,u=0,f=o||[],l=!1,p={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,n){return a=t,s=0,c=e,p.n=n,i}};function y(n,r){for(s=n,c=r,t=0;!l&&u&&!o&&t<f.length;t++){var o,a=f[t],y=p.p,d=a[2];n>3?(o=d===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=y&&((o=n<2&&y<a[1])?(s=0,p.v=r,p.n=a[1]):y<d&&(o=n<3||a[0]>r||r>d)&&(a[4]=n,a[5]=r,p.n=d,s=0))}if(o||n>1)return i;throw l=!0,r}return function(o,f,d){if(u>1)throw TypeError("Generator is already running");for(l&&1===f&&y(f,d),s=f,c=d;(t=s<2?e:c)||!l;){a||(s?s<3?(s>1&&(p.n=-1),y(s,c)):p.n=c:p.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(l=p.n<0)?c:n.call(r,p))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:l}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(E(t={},r,function(){return this}),t),l=u.prototype=s.prototype=Object.create(f);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,E(e,o,"GeneratorFunction")),e.prototype=Object.create(l),e}return c.prototype=u,E(l,"constructor",u),E(u,"constructor",c),c.displayName="GeneratorFunction",E(u,o,"GeneratorFunction"),E(l),E(l,o,"Generator"),E(l,r,function(){return this}),E(l,"toString",function(){return"[object Generator]"}),(O=function(){return{w:a,m:p}})()}function E(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}E=function(e,t,n,r){function a(t,n){E(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},E(e,t,n,r)}function w(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}var P=new k,R=!1;Office.onReady(function(){try{s("Office is ready - initializing Octagon functions"),P.initialize(),R=!0,s("API initialization complete. Authentication status: ".concat(P.isAuthenticated()?"Authenticated":"Not authenticated")),function(){try{CustomFunctions.associate("OCTAGON.OCTAGON_AGENT",_),CustomFunctions.associate("OCTAGON.DEEP_RESEARCH_AGENT",C),CustomFunctions.associate("OCTAGON.SCRAPER_AGENT",F),s("Custom functions registered successfully")}catch(e){u("Error registering custom functions:",e)}}()}catch(e){u("Error during initialization:",e)}});var N={research:"octagon-deep-research-agent",scraper:"octagon-scraper-agent",octagon:"octagon-agent"};function T(e,t,n){return I.apply(this,arguments)}function I(){var e;return e=O().m(function e(t,n,r){var o,a,i;return O().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,n&&""!==n.trim()){e.n=1;break}return e.a(2,"Error: Please provide a valid prompt");case 1:if(R){e.n=2;break}return e.a(2,"Error: API not initialized. Please try again in a few moments.");case 2:if(P.isAuthenticated()){e.n=3;break}return e.a(2,"Error: Not authenticated. Please enter your API key in the Login Screen.");case 3:return o=N[t.toLowerCase()]||t,e.n=4,P.callAgent(o,n);case 4:return a=e.v,e.a(2,a.data.content||"No response content");case 5:if(e.p=5,i=e.v,u("Error calling Octagon agent (".concat(t,"):"),i),!(i instanceof Error)){e.n=6;break}return e.a(2,"Error: ".concat(i.message));case 6:return CustomFunctions.associate("OCTAGON_AGENT",_),CustomFunctions.associate("DEEP_RESEARCH_AGENT",C),CustomFunctions.associate("SCRAPER_AGENT",F),e.a(2,"Error: An unexpected error occurred")}},e,null,[[0,5]])}),I=function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){w(a,r,o,i,s,"next",e)}function s(e){w(a,r,o,i,s,"throw",e)}i(void 0)})},I.apply(this,arguments)}function _(e){return T("octagon",e)}function C(e){return T("research",e)}function F(e){return T("scraper",e)}CustomFunctions.associate("OCTAGON_AGENT",_),CustomFunctions.associate("DEEP_RESEARCH_AGENT",C),CustomFunctions.associate("SCRAPER_AGENT",F)}();
//# sourceMappingURL=functions.js.map